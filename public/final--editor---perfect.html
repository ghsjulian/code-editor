<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Advanced Tab System Code Editor</title>
        <style>
            body {
                margin: 0;
                font-family: Arial, sans-serif;
                background-color: #1e1e1e;
                color: #fff;
                overflow: hidden;
            }
            .container {
                display: flex;
                height: 100vh;
            }
            .sidebar {
                width: 200px;
                background-color: #252526;
                border-right: 1px solid #3c3c3c;
                padding: 10px;
            }
            .sidebar h3 {
                margin: 10px 0;
                font-size: 16px;
                color: #ccc;
            }
            .file {
                padding: 8px;
                cursor: pointer;
                color: #fff;
                font-size: 14px;
                transition: background-color 0.2s;
            }
            .file:hover {
                background-color: #323232;
            }
            .main {
                flex: 1;
                display: flex;
                flex-direction: column;
            }
            .tabs {
                display: flex;
                background-color: #252526;
                border-bottom: 1px solid #3c3c3c;
                padding: 5px;
                align-items: center;
            }
            .tab {
                padding: 10px 20px;
                cursor: pointer;
                background-color: #252526;
                color: #fff;
                border-right: 1px solid #3c3c3c;
                transition: background-color 0.2s;
            }
            .tab:hover {
                background-color: #323232;
            }
            .tab.active {
                background-color: #1e1e1e;
                border-bottom: 2px solid #007acc;
            }
            .toolbar {
                margin-left: auto;
                padding: 5px 10px;
            }
            .toolbar button {
                background-color: #007acc;
                color: #fff;
                border: none;
                padding: 5px 10px;
                border-radius: 3px;
                cursor: pointer;
                font-size: 14px;
            }
            .toolbar button:hover {
                background-color: #005f99;
            }
            .editor-container {
                flex: 1;
                display: flex;
            }
            .editor {
                flex: 1;
                display: none;
            }
            .editor.active {
                display: block;
            }
            .preview {
                flex: 1;
                border-left: 1px solid #3c3c3c;
                background-color: #fff;
            }
            #preview-frame {
                width: 100%;
                height: 100%;
                border: none;
            }
            .ace_editor {
                width: 100% !important;
                height: 100% !important;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="sidebar">
                <h3>Files</h3>
                <div class="file" data-file="index.html">index.html</div>
                <div class="file" data-file="styles.css">styles.css</div>
                <div class="file" data-file="script.js">script.js</div>
            </div>
            <div class="main">
                <div class="tabs">
                    <div class="tab active" data-tab="html">HTML</div>
                    <div class="tab" data-tab="css">CSS</div>
                    <div class="tab" data-tab="js">JavaScript</div>
                    <div class="toolbar">
                        <button id="formatButton">Format Code</button>
                    </div>
                </div>
                <div class="editor-container">
                    <div class="editor active" id="html-editor"></div>
                    <div class="editor" id="css-editor"></div>
                    <div class="editor" id="js-editor"></div>
                    <div class="preview">
                        <iframe id="preview-frame"></iframe>
                    </div>
                </div>
            </div>
        </div>

        <script src="ace/src-noconflict/ace.js"></script>
        <script src="ace/src-noconflict/ext-language_tools.js"></script>
        <script src="ace/src-noconflict/ext-beautify.js"></script>
        <script>
            // Enable language tools for autocompletion
            ace.require("ace/ext/language_tools");

            // Static file contents
            const files = {
                "index.html": `<!DOCTYPE html>
<html>
<head>
    <title>Test Page</title>
</head>
<body>
    <h1 id="testTitle">Welcome to My Page!</h1>
    <p>Click the button to change the title.</p>
    <button onclick="updateTitle()">Update Title</button>
</body>
</html>`,
                "styles.css": `body {
    background-color: #e6f3ff;
    font-family: 'Helvetica', sans-serif;
    text-align: center;
    padding: 30px;
}

h1 {
    color: #0066cc;
}

p {
    font-size: 18px;
    color: #333;
}

button {
    padding: 12px 24px;
    font-size: 16px;
    background-color: #28a745;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

button:hover {
    background-color: #218838;
}`,
                "script.js": `function updateTitle() {
    const title = document.getElementById('testTitle');
    title.textContent = 'Title Updated!';
    title.style.color = '#cc0000';
    document.querySelector('p').textContent = 'You clicked the button!';
}`
            };

            // Initialize Ace Editors
            const htmlEditor = ace.edit("html-editor");
            const cssEditor = ace.edit("css-editor");
            const jsEditor = ace.edit("js-editor");

            // Editor configurations
            const editorConfig = {
                enableBasicAutocompletion: true,
                enableSnippets: true,
                enableLiveAutocompletion: true,
                selectionStyle: "text",
                highlightActiveLine: true,
                highlightSelectedWord: true,
                readOnly: false,
                cursorStyle: "ace",
                mergeUndoDeltas: true,
                behavioursEnabled: true,
                wrapBehavioursEnabled: true,
                autoScrollEditorIntoView: true,
                fontSize: "16px",
                fontFamily: "monospaceromium",
                animatedScroll: true,
                displayIndentGuides: true,
                showInvisibles: false,
                showPrintMargin: true,
                showGutter: true,
                fadeFoldWidgets: true,
                showFoldWidgets: true,
                showLineNumbers: true,
                tabSize: 4,
                useWorker: true,
                useSoftTabs: true,
                wrap: false,
                scrollPastEnd: 0,
                scrollSpeed: 3,
                dragDelay: 0,
                dragEnabled: true
            };

            // Apply configurations
            htmlEditor.setOptions(editorConfig);
            cssEditor.setOptions(editorConfig);
            jsEditor.setOptions(editorConfig);

            // Set modes and themes
            htmlEditor.session.setMode("ace/mode/html");
            cssEditor.session.setMode("ace/mode/css");
            jsEditor.session.setMode("ace/mode/javascript");

            htmlEditor.setTheme("ace/theme/monokai");
            cssEditor.setTheme("ace/theme/monokai");
            jsEditor.setTheme("ace/theme/monokai");

            htmlEditor.getSession().setUseWrapMode(false);
            cssEditor.getSession().setUseWrapMode(false);
            jsEditor.getSession().setUseWrapMode(false);

            htmlEditor.getSession().setUseSoftTabs(true);
            cssEditor.getSession().setUseSoftTabs(true);
            jsEditor.getSession().setUseSoftTabs(true);

            htmlEditor.setOption("printMargin", 180);
            cssEditor.setOption("printMargin", 180);
            jsEditor.setOption("printMargin", 180);

            htmlEditor.setOption("persistentHScrollBar", true);
            cssEditor.setOption("persistentHScrollBar", true);
            jsEditor.setOption("persistentHScrollBar", true);

            htmlEditor.setScrollSpeed(1);
            cssEditor.setScrollSpeed(1);
            jsEditor.setScrollSpeed(1);

            // Initialize editors with empty content
            htmlEditor.setValue("");
            cssEditor.setValue("");
            jsEditor.setValue("");

            // Auto-format function
            const beautify = ace.require("ace/ext/beautify");
            function formatCode(editor) {
                beautify.beautify(editor.session);
            }

            // Format button functionality
            document
                .getElementById("formatButton")
                .addEventListener("click", () => {
                    const activeEditor =
                        document.querySelector(".editor.active");
                    const editorId = activeEditor.id;
                    const editorMap = {
                        "html-editor": htmlEditor,
                        "css-editor": cssEditor,
                        "js-editor": jsEditor
                    };
                    const editor = editorMap[editorId];
                    formatCode(editor);
                    editor.focus();
                });

            // Tab switching functionality
            const tabs = document.querySelectorAll(".tab");
            const editors = document.querySelectorAll(".editor");

            tabs.forEach(tab => {
                tab.addEventListener("click", () => {
                    tabs.forEach(t => t.classList.remove("active"));
                    editors.forEach(e => e.classList.remove("active"));

                    tab.classList.add("active");
                    document
                        .getElementById(`${tab.dataset.tab}-editor`)
                        .classList.add("active");

                    htmlEditor.resize();
                    cssEditor.resize();
                    jsEditor.resize();
                });
            });

            // Sidebar file opening functionality
            const fileItems = document.querySelectorAll(".file");
            fileItems.forEach(fileItem => {
                fileItem.addEventListener("click", () => {
                    const fileName = fileItem.dataset.file;
                    const extension = fileName.split(".").pop().toLowerCase();
                    const content = files[fileName];
                    let editor;

                    // Switch to the appropriate editor based on file extension
                    tabs.forEach(t => t.classList.remove("active"));
                    editors.forEach(e => e.classList.remove("active"));

                    if (extension === "html" || extension === "htm") {
                        editor = htmlEditor;
                        document
                            .querySelector('[data-tab="html"]')
                            .classList.add("active");
                        document
                            .getElementById("html-editor")
                            .classList.add("active");
                    } else if (extension === "css") {
                        editor = cssEditor;
                        document
                            .querySelector('[data-tab="css"]')
                            .classList.add("active");
                        document
                            .getElementById("css-editor")
                            .classList.add("active");
                    } else if (extension === "js") {
                        editor = jsEditor;
                        document
                            .querySelector('[data-tab="js"]')
                            .classList.add("active");
                        document
                            .getElementById("js-editor")
                            .classList.add("active");
                    }

                    editor.setValue(content);
                    formatCode(editor); // Auto-format on file load
                    editor.clearSelection();
                    editor.resize();
                    updatePreview();
                });
            });

            // Live preview update
            function updatePreview() {
                const html =
                    htmlEditor.getValue() || "<html><body></body></html>";
                const css = `<style>${cssEditor.getValue()}</style>`;
                const js = `<script>${jsEditor.getValue()}<\/script>`;

                const previewFrame = document.getElementById("preview-frame");
                const previewDoc =
                    previewFrame.contentDocument ||
                    previewFrame.contentWindow.document;

                previewDoc.open();
                previewDoc.write(
                    html
                        .replace("</head>", `${css}</head>`)
                        .replace("</body>", `${js}</body>`)
                );
                previewDoc.close();
            }

            // Update preview on editor changes
            htmlEditor.session.on("change", updatePreview);
            cssEditor.session.on("change", updatePreview);
            jsEditor.session.on("change", updatePreview);

            // Initial preview
            updatePreview();
        </script>
    </body>
</html>
